{% extends "base_order.html" %}
<!-- Load internationalisation utils-->
{% load i18n %}

{% block title %} {% trans 'View Order' %} {% endblock %}

{% block extrajs %}

    <script type="text/javascript">
        $('.ui.dropdown.status').dropdown({
            transition: 'drop',
            onChange: function(value, text, $selectedItem) {
                $(this).addClass('loading');
                $.ajax({
                    url: "/order/change_status/" + {{ order.id }} + '/',
                    type: "POST",
                    data: {
                        'status': value,
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function(response) {
                        $('.ui.dropdown.status').removeClass('loading');
                    }
                })
            }
        });
    </script>

{% endblock %}

{% block content %}

<div class="ui secondary pointing fluid menu">
    <h2 class="ui header">Order #{{ order.id}}</h2>
    <div class="right menu">
        <div class="ui item">
            <div class="ui dropdown status">
                <div class="ui large yellow label text">{{ order.get_status_display }}</div>
                <i class="dropdown icon"></i>
                <div class="menu">
                    {% for k,s in status %}
                        <div class="item" data-value={{k}}>
                             {{s}}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ui row"></div>

<div class="ui four wide">
    {% include "_order_info.html" %}
</div>

<div class="ui twelve wide" style="margin: 0 auto;">
    <h4>Order detail</h4>
    <table class="ui very basic stripped celled table">
      <thead>
        <th>Item</th>
        <th>Description</th>
        <th class="">{% trans 'Quantity' %}</th>
        <th class="">{% trans 'Price' %}</th>
      </thead>
      <tbody>
          {% for item in order.orders.all %}
          <tr>
            <td><strong>{{item.component.name}}</strong></td>
            <td>{{item.component.description}}</td>
            <td>{{item.total_quantity}}</td>
            <td>${{item.price}}</td>
          </tr>
          {% endfor %}
      </tbody>
      <tfoot>
          <tr>
              <th colspan="3">Total</th>
              <th>${{ order.price }}</th>
          </tr>
      </tfoot>
  </table>
</div>
<div class="ui row"></div>
{% endblock %}
