{% extends "base.html" %}
<!-- Load internationalisation utils-->
{% load i18n %}
{% load static %}

{% block title %} {% trans 'Orders' %} {% endblock %}

{% block content %}

<div class="ui secondary pointing fluid menu">
    <h2 class="ui header">Orders</h2>
</div>


<div class="ui mobile reversed equal width grid">
  <div class="column">

    <form action="" method="get" class="ui form">

        <div class="inline fields">
            <div class="field">
                <label>Name</label>
                <div class="field">
                    <div class="ui large left icon input">
                        <i class="users icon"></i>
                        {{ filter.form.name }}
                    </div>
                </div>
            </div>
            <div class="field">
                <label>Status</label>
                <div class="field">
                    {{ filter.form.status }}
                </div>
            </div>
            <div class="field">
                <label>Delivery date</label>
                <div class="field">
                    <div class="ui calendar" id="order_delivery_date">
                        <div class="ui input left icon">
                              <i class="calendar icon"></i>
                              {{ filter.form.delivery_date }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="field">
            <a href="{% url 'order:list' %}" class="ui button">Reset</a>
            <button class="ui yellow button" type="submit">Search</button>
        </div>
    </form>
    <br/><br/>
  </div>
</div>


<table class="ui very basic stripped celled table">
  <thead>
    <th class="sorted descending">Order</th>
    <th class="">{% trans 'Client' %}</th>
    <th class="">{% trans 'Delivery Date' %}</th>
    <th class="">{% trans 'Status' %}</th>
    <th class="">{% trans 'Amount' %}</th>
    <th class=""></th>
  </thead>
  <tbody>
    {% for obj in order %}
      <tr>
        <td><strong>{{obj.id}}</strong></td>
        <td><a href="{% url 'member:client_information' pk=obj.client.id %}">{{obj.client.member}}</a></td>
        <td>{{obj.delivery_date}}</td>
        <td>{{obj.get_status_display}}</td>
        <td>${{obj.price}}</td>
        <td>
          <button class="ui button"  onclick="location.href='{% url 'order:view' pk=obj.id %}';" value="View Order" >View Order</button>
          <button class="ui button"  onclick="location.href='{% url 'order:update' pk=obj.id %}';" value="Update Order" >Update Order</button>
        </td>
      </tr>
        {% endfor %}
  </tbody>
  <tfoot>
      <tr>
          <th></th>
          <th colspan="5">
              {% include "system/_button_export.html" %}
          </th>
        </tr>
  </tfoot>
</table>
<script type="text/javascript">
    document.addEventListener( 'DOMContentLoaded', function () {
      $('table').tablesort();
    })
</script>

{% endblock %}

{% block extrajs %}
  <script src="{% static 'jquery/calendar.min.js' %}" type="application/javascript"></script>
  <script type="text/javascript">
    $(function() {
      $('#order_delivery_date').calendar({
        type: 'date',
        formatter: {
          date: function (date, settings) {
            if (!date) return '';
            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();
            if (month < 10) month = '0' + month;
            if (day < 10) day = '0' + day;
            return year + '-' + month + '-' + day;
          }
        }
      });
      $('#wizard_form_date').calendar({
        type: 'date',
        formatter: {
          date: function (date, settings) {
            if (!date) return '';
            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();
            if (month < 10) month = '0' + month;
            if (day < 10) day = '0' + day;
            return year + '-' + month + '-' + day;
          }
        }
      });

      $('.ui.button.add.member').on('click', function() {
        $('.existing--member').val('').attr('disabled', 'disabled');
        $(this).transition('scale');
        $('.ui.add.form.member').transition('scale');
      });
      $('.ui.button.cancel.add.member').on('click', function() {
        $('.ui.button.add.member').transition('scale');
        $('.existing--member').removeAttr('disabled');
      });
      if( $('.firstname').val() !== '' || $('.lastname').val() !== ''
          &&
          $('.existing--member').val() === '' ) {
        $('.ui.button.add.member').transition('scale');
        $('.existing--member').attr('disabled', 'disabled');
        $('.ui.add.form.member').transition('scale');
      }
      $('.ui.search')
        .search({
          apiSettings: {
            cache : 'local',
            url: '{% url 'member:search' %}?name={query}'
          },
          minCharacters : 3
        });
    });

    </script>
{% endblock %}
