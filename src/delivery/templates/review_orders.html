{% extends "base.html" %}
<!-- Load internationalisation utils-->
{% load i18n %}
{% load static %}

{% block title %} {% trans 'Orders' %} {% endblock %}

{% block content %}

{% include 'kitchen_count_steps.html' with step='orders' %}

<div class="ui secondary pointing fluid menu">
    <h1 class="ui header">{% trans "Review Orders" %}</h1>
    <div class="right menu">
      <div class="ui item"><h3><i class="calendar icon"></i>{% now "j F Y" %}</h3></div>
    </div>
</div>

<div class="ui stackable relaxed grid container">

    <div class="sixteen wide column">

        <div class="ui list">
            <a class="item">
                <i class="right triangle icon"></i>
                <div class="content">
                    <div class="header">{% trans 'Orders of the day' %}</div>
                    <div class="description">
                        {% trans 'Orders of the day include ongoing and episodic clients. Only Ordered orders from Active clients are included.' %}
                    </div>
                </div>
            </a>
            <a class="item">
                <i class="refresh icon"></i>
                <div class="content">
                    <div class="header">Generate orders</div>
                    <div class="description">Orders for ongoing clients are automatically generated at midnight every day, based on their default preferences. Press the <em>Generate orders</em> button to manually run the script.</div>
                </div>
            </a>
            <a class="item">
                <i class="marker icon"></i>
                <div class="content">
                    <div class="header">Geolocation</div>
                    <div class="description">Highlighted orders are not properly geolocated. Edit the client information to fix it.</div>
                </div>
            </a>
        </div>

    </div>


    <div class="sixteen wide center aligned column">
        <div class="ui row">
            <div class="ui labeled button" tabindex="0">
                <div class="ui pink big button orders" data-url="{% url 'delivery:refresh_orders'%}">
                    <i class="refresh icon"></i> {% trans 'Generate orders' %}
                </div>
                <a class="ui basic left pointing pink label orders-count" data-order-count={{orders.count}}>
                    {% blocktrans with count=orders.count  %}
                        <span>{{ count }}</span>
                        &nbsp;today
                    {% endblocktrans %}
                </a>
            </div>
        </div>
    </div>

    <h4 class="ui horizontal divider header">
        <i class="unhide icon"></i>
        {% trans 'Review' %}
    </h4>



<table class="ui very basic stripped compact celled table">
  <thead>
    <th class="">{% trans 'Order' %}
            <i class="help-text question grey icon link" data-content="{% trans 'A unique identifier for the order.' %}"></i>
    </th>
    <th class="">{% trans 'Client' %}
        <i class="help-text question grey icon link" data-content="{% trans 'Quickly access the client file.' %}"></i>
    </th>
    <th class="">{% trans 'Delivery Date' %}
        <i class="help-text question grey icon link" data-content="{% trans 'The delivery date planned for the order.' %}"></i>
    </th>
    <th class="">{% trans 'Route' %}
        <i class="help-text question grey icon link" data-content="{% trans 'The delivery route.' %}"></i>
    </th>
    <th class="center aligned">{% trans 'Status' %}
        <i class="help-text question grey icon link" data-content="{% trans 'Display only Ordered orders.' %}"></i>
    </th>
    <th class="center aligned">{% trans 'Amount' %}
        <i class="help-text question grey icon link" data-content="{% trans 'Total amount in $CAD.' %}"></i>
    </th>
    <th class=""></th>
  </thead>
  <tbody>
    {% for order in orders %}
      <tr {% if not order.client.is_geolocalized %}class="warning"{% endif %}>
        <td class="center aligned"><strong><i class="hashtag icon"></i>{{order.id}}</strong></td>
        <td><a href="{% url 'member:client_information' pk=order.client.id %}">{{order.client.member}}</a></td>
        <td>{{order.delivery_date}}</td>
        <td>{{order.client.route}}</td>
        <td class="center aligned">{{order.get_status_display}}</td>
        <td class="center aligned"><i class="dollar icon"></i>{{order.price}}</td>
        <td>
            <a class="ui basic icon button"  href="{% url 'order:view' pk=order.id %}"><i class="icon unhide"></i></a>
            <a class="ui basic icon button"  href="{% url 'order:update' pk=order.id %}"><i class="icon edit"></i></a>
            <a class="ui basic icon button order-delete" href="#" data-order-id="{{order.id}}"><i class="icon trash"></i></a>
        </td>
      </tr>
      {% include 'review_order_confirm_delete.html' %}
      {% endfor %}
  </tbody>
</table>

<a class="big ui yellow right floated button" href="{% url 'delivery:meal' %}">{% trans "OK, I'm ready" %}</a>

</div>

{% endblock %}
